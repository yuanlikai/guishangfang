webpackJsonp([2],{"6uyZ":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),r=a.n(i),n={data:function(){var e=this;return{defaultList:[],imgName:"",visible:!1,uploadList:[],state:0,modal2:!1,imgSrc:"",ad_id:"",positLi:[],formValidate:{name:"",city:"",time:[],img:""},poist:[],ruleValidate:{name:[{required:!0,message:"请填写活动标题!",trigger:"blur"}],city:[{required:!0,message:"请选择活动位置!",trigger:"change"}],time:[{required:!0,validator:function(t,a,i){e.formValidate.time[0].length<1?i(new Error("请选择日期")):i()},trigger:"change"}],img:[{required:!0,validator:function(t,a,i){e.uploadList.length>6?i(new Error("最多选择6张图片")):e.uploadList.length<1?i(new Error("请上传图片")):i()},trigger:"change"}]},modal1:!1,pag:1,loading2:!0,loading1:!0,total:0,columns1:[{title:"ID",align:"center",key:"ad_id",width:50},{title:"活动标题",align:"center",key:"ad_name"},{title:"活动主图",align:"center",key:"banner_url",render:function(t,a){return t("div",[t("img",{attrs:{src:"http://img.gsfzd.com/"+JSON.parse(a.row.ad_pic)[0].response},style:{width:"30px",cursor:"pointer"},on:{click:function(){e.modal2=!0,e.imgSrc="http://img.gsfzd.com/"+JSON.parse(a.row.ad_pic)[0].response}}})])}},{title:"活动位置",align:"center",key:"ad_seat"},{title:"开始时间",align:"center",key:"ad_addtime",render:function(t,a){return t("div",[t("p",e.timestampToTime(a.row.ad_addtime).split(" ")[0])])}},{title:"结束时间",align:"center",key:"ad_endtime",render:function(t,a){return t("div",[t("p",e.timestampToTime(a.row.ad_endtime).split(" ")[0])])}},{title:"活动状态",align:"center",render:function(e,t){return console.log(t.row),t.row.ad_endtime+86400<Date.parse(new Date)/1e3?e("div",[e("del",{},"已结束")]):t.row.ad_addtime>Date.parse(new Date)/1e3?e("div",[e("p",{style:{color:"#19be6b"}},"未开始")]):e("div",[e("p",{style:{color:"#2d8cf0 "}},"进行中")])}},{title:"操作",align:"center",render:function(t,a){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){console.log(a.row);var t=e;t.shoale(),t.state=1,t.ad_id=a.row.ad_id,t.formValidate.name=a.row.ad_name,t.formValidate.city=a.row.ad_seat,t.defaultList=JSON.parse(a.row.ad_pic),t.formValidate.time=[],t.formValidate.time.push(String(t.timestampToTime(a.row.ad_addtime).split(" ")[0])),t.formValidate.time.push(String(t.timestampToTime(a.row.ad_endtime).split(" ")[0])),t.imgS()}}},"修改"),t("Poptip",{props:{confirm:!0,transfer:!0,title:"是否继续删除该banner?"},on:{"on-ok":function(){var t=e;t.Axios.post("/api/index.php/admin/ad/del",t.Qs.stringify({ad_id:a.row.ad_id})).then(function(e,a){0===e.data.error?t.positList():t.$Message.error(e.data.errMsg)})}}},[t("Button",{props:{type:"error",size:"small"}},"删除")])])}}],data1:[]}},methods:{shoale:function(){this.$refs.formValidate.resetFields(),this.state=0,this.modal1=!0,this.loading1=!0,this.city()},handleSubmit:function(e){var t=this;console.log(new Date(this.formValidate.time[0]).getTime()/1e3),this.$refs[e].validate(function(e){if(e){var a=t,i=new Date(t.formValidate.time[0]).getTime()/1e3,n=new Date(t.formValidate.time[1]).getTime()/1e3;a.Axios.post("/api/index.php/admin/ad/add",a.Qs.stringify({ad_id:0===a.state?"":a.ad_id,ad_name:a.formValidate.name,ad_seat:a.formValidate.city,ad_pic:String(r()(a.uploadList)),ad_addtime:i,ad_endtime:n})).then(function(e,t){console.log(e.data),0===e.data.error?(a.modal1=!1,a.positList(),a.$refs.formValidate.resetFields(),a.$refs.upload.fileList.splice(0,6)):(a.$Message.error(e.data.errMsg),a.loading1=!1)})}else t.$Message.error("添加活动失败!"),t.loading1=!1})},city:function(){var e=this;e.Axios.post("/api/index.php/admin/banner/city").then(function(t,a){if(0===t.data.error){e.positLi=[{areaId:0,areaName:"全部显示"}].concat(t.data.data)}else e.$Message.error(t.data.errMsg)})},positList:function(){var e=this;e.loading2=!0,e.Axios.post("/api/index.php/admin/ad/index",e.Qs.stringify({pag:e.pag,num:11})).then(function(t,a){console.log(t.data),e.loading2=!1,0===t.data.error?(e.data1=t.data.data.info,e.total=t.data.data.nodes):e.$Message.error(t.data.errMsg)})},page:function(e){this.pag=e,this.positList()},quanx:function(){var e=this;e.Axios.post("/api/index.php/admin/role/index1").then(function(t,a){0===t.data.error?e.poist=t.data.data:e.$Message.error(t.data.errMsg)})},handleView:function(e){this.imgName=e,this.visible=!0},handleRemove:function(e){var t=this.$refs.upload.fileList;this.$refs.upload.fileList.splice(t.indexOf(e),1)},handleSuccess:function(e,t){t.url="http://img.gsfzd.com/"+e,t.name="7eb99afb9d5f317c912f08b5212fd69a"},handleFormatError:function(e){this.$Notice.warning({title:"The file format is incorrect",desc:"File format of "+e.name+" is incorrect, please select jpg or png."})},handleMaxSize:function(e){this.$Notice.warning({title:"Exceeding file size limit",desc:"File  "+e.name+" is too large, no more than 2M."})},handleBeforeUpload:function(){var e=this.uploadList.length<6;return e||this.$Notice.warning({title:"Up to five pictures can be uploaded."}),e},cancel:function(){this.$Message.info("你点击了取消"),this.$refs.upload.fileList.splice(0,6)},imgS:function(){var e=this;setTimeout(function(){e.uploadList=e.$refs.upload.fileList},0)}},mounted:function(){this.imgS(),this.quanx(),this.positList()}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Layout",{style:{padding:"0 24px 24px"}},[a("Breadcrumb",{style:{margin:"24px 0"}},[a("BreadcrumbItem",[e._v("活动管理")])],1),e._v(" "),a("Content",{style:{padding:"24px",minHeight:"280px",background:"#fff"}},[a("Button",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"primary"},on:{click:function(t){e.shoale()}}},[a("Icon",{attrs:{type:"md-add"}}),e._v("\n      添加活动\n    ")],1),e._v(" "),a("Table",{attrs:{loading:e.loading2,columns:e.columns1,data:e.data1,height:"568",border:""}})],1),e._v(" "),a("div",{staticStyle:{float:"left",width:"100%","text-align":"center","margin-top":"25px"}},[a("Page",{attrs:{total:e.total,"page-size":11},on:{"on-change":e.page}})],1),e._v(" "),a("Modal",{attrs:{title:"活动主图",styles:{textAlign:"center"}},model:{value:e.modal2,callback:function(t){e.modal2=t},expression:"modal2"}},[a("img",{staticStyle:{"max-width":"100%"},attrs:{src:e.imgSrc,alt:""}})]),e._v(" "),a("Modal",{attrs:{title:"请认真填写banner",loading:e.loading1,styles:{width:"420px"}},on:{"on-ok":function(t){e.handleSubmit("formValidate")},"on-cancel":e.cancel},model:{value:e.modal1,callback:function(t){e.modal1=t},expression:"modal1"}},[a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":80}},[a("FormItem",{attrs:{label:"活动标题",prop:"name"}},[a("Input",{attrs:{placeholder:"请填写活动标题"},model:{value:e.formValidate.name,callback:function(t){e.$set(e.formValidate,"name",t)},expression:"formValidate.name"}})],1),e._v(" "),a("FormItem",{attrs:{label:"活动位置",prop:"city"}},[a("Select",{attrs:{placeholder:"选择活动位置"},model:{value:e.formValidate.city,callback:function(t){e.$set(e.formValidate,"city",t)},expression:"formValidate.city"}},[a("Option",{attrs:{value:"主页"}},[e._v("主页")])],1)],1),e._v(" "),a("FormItem",{attrs:{label:"活动时间",prop:"time"}},[a("DatePicker",{attrs:{placement:"bottom-end",placeholder:"Select date",format:"yyyy/MM/dd",editable:!1,type:"daterange"},model:{value:e.formValidate.time,callback:function(t){e.$set(e.formValidate,"time",t)},expression:"formValidate.time"}})],1),e._v(" "),a("FormItem",{attrs:{label:"图片上传（第1次张为主图，其余为详情）",prop:"img"}},[e._l(e.uploadList,function(t){return a("div",{staticClass:"demo-upload-list"},["finished"===t.status?[a("img",{attrs:{src:t.url}}),e._v(" "),a("div",{staticClass:"demo-upload-list-cover"},[a("Icon",{attrs:{type:"ios-eye-outline"},nativeOn:{click:function(a){e.handleView(t.url)}}},[e._v(e._s(t.name))]),e._v(" "),a("Icon",{attrs:{type:"ios-trash-outline"},nativeOn:{click:function(a){e.handleRemove(t)}}})],1)]:[t.showProgress?a("Progress",{attrs:{percent:t.percentage,"hide-info":""}}):e._e()]],2)}),e._v(" "),a("Upload",{ref:"upload",staticStyle:{display:"inline-block",width:"58px"},attrs:{"show-upload-list":!1,"default-file-list":e.defaultList,"on-success":e.handleSuccess,format:["jpg","jpeg","png"],"max-size":2048,"on-format-error":e.handleFormatError,"on-exceeded-size":e.handleMaxSize,"before-upload":e.handleBeforeUpload,multiple:"",type:"drag",action:"api/publics/picture/imgouter",data:{location:"home"}}},[a("div",{staticStyle:{width:"58px",height:"58px","line-height":"58px"}},[a("Icon",{attrs:{type:"ios-camera",size:"20"}})],1)])],2)],1)],1),e._v(" "),a("Modal",{attrs:{title:"View Image",styles:{textAlign:"center"}},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[e.visible?a("img",{staticStyle:{"max-width":"100%"},attrs:{src:e.imgName}}):e._e()])],1)},staticRenderFns:[]};var s=a("VU/8")(n,o,!1,function(e){a("DEqs")},null,null);t.default=s.exports},DEqs:function(e,t){},mvHQ:function(e,t,a){e.exports={default:a("qkKv"),__esModule:!0}},qkKv:function(e,t,a){var i=a("FeBl"),r=i.JSON||(i.JSON={stringify:JSON.stringify});e.exports=function(e){return r.stringify.apply(r,arguments)}}});
//# sourceMappingURL=2.6ce6bb955ae9d52c3e2e.js.map